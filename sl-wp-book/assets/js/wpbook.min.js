(function ( $ ) {
    'use strict';

    /**
     * All of the code for your admin-facing JavaScript source
     * should reside in this file.
     */

    jQuery(
        function () {
            jQuery('.wp-book-select2').select2(
                {
                    width: '100%'
                }
            );

            load_material();

            jQuery('#generate_book').click(
                function () {
                    var btn_val = jQuery('#generate_book').val();
                    jQuery('#generate_book').addClass('disabled');
                    jQuery('#generate_book').val('Please Wait...');
                    jQuery('.download_book').hide();
                    var data = {
                        action : 'generate_book',
                        security: wp_book_object.ajax_nonce,
                        material : jQuery('#wp-book-form').serializeArray(),
                    }
                    jQuery.post(
                        wp_book_object.ajaxurl, data, function (response) {
                            if(response.result == 'success' ) {
                                jQuery('.download_book').show();
                                jQuery('.download_book').attr('href', response.upload_url);
                            }else{
                                jQuery('.download_book').hide();
                            }
                            show_notice(response.message, response.notice_class, true);
                            jQuery('#generate_book').val(btn_val);
                            jQuery('#generate_book').removeClass('disabled');
                        }
                    );
                }
            );
        }
    );

})(jQuery);

function load_material()
{
    jQuery('.wp-book-pdf-material-stage').html('Please wait...');
    jQuery('.download_book').hide();
    var data = {
        action : 'load_posts_for_print',
        security: wp_book_object.ajax_nonce,
        post_type : jQuery('.filter-post-type').val(),
        posts_per_page : jQuery('.filter-post-number').val(),
        order : jQuery('.filter-post-order').val(),
        order_by : jQuery('.filter-post-order-by').val(),
    }

    jQuery.post(
        wp_book_object.ajaxurl, data, function (response) {
            jQuery('.wp-book-pdf-material-stage').html('');
            jQuery(response).each(
                function ( id, post ) {
            
                    var material_node = '<div class="material-node"><h2>'+post.post_title+'</h2>';
                    material_node += '<input type="hidden" name="material" value="'+post.ID+'" />';
                    material_node += '<div>';

                    jQuery('.wp-book-pdf-material-stage').append(material_node);
                }
            );
            jQuery('.wp-book-pdf-material-stage').sortable();
        }
    );
}

function show_notice( message, type, dismissible )
{
    if (dismissible ) {
        var dismissible_class = "is-dismissible";
    }
    var output = '<div class="notice '+type+' '+dismissible_class+'">';
    output += '<p>'+message+'</p>';
    output += '</div>';
    jQuery('.wp-book-form-wrapper').prepend(output)
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndwYm9vay5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJ3cGJvb2subWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCAkICkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0LyoqXG5cdCAqIEFsbCBvZiB0aGUgY29kZSBmb3IgeW91ciBhZG1pbi1mYWNpbmcgSmF2YVNjcmlwdCBzb3VyY2Vcblx0ICogc2hvdWxkIHJlc2lkZSBpbiB0aGlzIGZpbGUuXG5cdCAqL1xuXG5cdGpRdWVyeShmdW5jdGlvbigpe1xuXHRcdGpRdWVyeSgnLndwLWJvb2stc2VsZWN0MicpLnNlbGVjdDIoe1xuXHRcdFx0d2lkdGg6ICcxMDAlJ1xuXHRcdH0pO1xuXG5cdFx0bG9hZF9tYXRlcmlhbCgpO1xuXG5cdFx0alF1ZXJ5KCcjZ2VuZXJhdGVfYm9vaycpLmNsaWNrKGZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgYnRuX3ZhbCA9IGpRdWVyeSgnI2dlbmVyYXRlX2Jvb2snKS52YWwoKTtcblx0XHRcdGpRdWVyeSgnI2dlbmVyYXRlX2Jvb2snKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdGpRdWVyeSgnI2dlbmVyYXRlX2Jvb2snKS52YWwoICdQbGVhc2UgV2FpdC4uLicgKTtcblx0XHRcdGpRdWVyeSgnLmRvd25sb2FkX2Jvb2snKS5oaWRlKCk7XG5cdFx0XHR2YXIgZGF0YSA9IHtcblx0XHRcdFx0YWN0aW9uIDogJ2dlbmVyYXRlX2Jvb2snLFxuXHRcdFx0XHRzZWN1cml0eTogd3BfYm9va19vYmplY3QuYWpheF9ub25jZSxcblx0XHRcdFx0bWF0ZXJpYWwgOiBqUXVlcnkoJyN3cC1ib29rLWZvcm0nKS5zZXJpYWxpemVBcnJheSgpLFxuXHRcdFx0fVxuXHRcdFx0alF1ZXJ5LnBvc3Qod3BfYm9va19vYmplY3QuYWpheHVybCwgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0aWYoIHJlc3BvbnNlLnJlc3VsdCA9PSAnc3VjY2VzcycgKXtcblx0XHRcdFx0XHRqUXVlcnkoJy5kb3dubG9hZF9ib29rJykuc2hvdygpO1xuXHRcdFx0XHRcdGpRdWVyeSgnLmRvd25sb2FkX2Jvb2snKS5hdHRyKCAnaHJlZicsIHJlc3BvbnNlLnVwbG9hZF91cmwgKTtcblx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0alF1ZXJ5KCcuZG93bmxvYWRfYm9vaycpLmhpZGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRzaG93X25vdGljZSggcmVzcG9uc2UubWVzc2FnZSwgcmVzcG9uc2Uubm90aWNlX2NsYXNzLCB0cnVlICk7XG5cdFx0XHRcdGpRdWVyeSgnI2dlbmVyYXRlX2Jvb2snKS52YWwoIGJ0bl92YWwgKTtcblx0XHRcdFx0alF1ZXJ5KCcjZ2VuZXJhdGVfYm9vaycpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdH0pO1xuXG59KSggalF1ZXJ5ICk7XG5cbmZ1bmN0aW9uIGxvYWRfbWF0ZXJpYWwoKXtcblx0alF1ZXJ5KCcud3AtYm9vay1wZGYtbWF0ZXJpYWwtc3RhZ2UnKS5odG1sKCdQbGVhc2Ugd2FpdC4uLicpO1xuXHRqUXVlcnkoJy5kb3dubG9hZF9ib29rJykuaGlkZSgpO1xuXHR2YXIgZGF0YSA9IHtcblx0XHRhY3Rpb24gOiAnbG9hZF9wb3N0c19mb3JfcHJpbnQnLFxuXHRcdHNlY3VyaXR5OiB3cF9ib29rX29iamVjdC5hamF4X25vbmNlLFxuXHRcdHBvc3RfdHlwZSA6IGpRdWVyeSgnLmZpbHRlci1wb3N0LXR5cGUnKS52YWwoKSxcblx0XHRwb3N0c19wZXJfcGFnZSA6IGpRdWVyeSgnLmZpbHRlci1wb3N0LW51bWJlcicpLnZhbCgpLFxuXHRcdG9yZGVyIDogalF1ZXJ5KCcuZmlsdGVyLXBvc3Qtb3JkZXInKS52YWwoKSxcblx0XHRvcmRlcl9ieSA6IGpRdWVyeSgnLmZpbHRlci1wb3N0LW9yZGVyLWJ5JykudmFsKCksXG5cdH1cblxuXHRqUXVlcnkucG9zdCh3cF9ib29rX29iamVjdC5hamF4dXJsLCBkYXRhLCBmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdGpRdWVyeSgnLndwLWJvb2stcGRmLW1hdGVyaWFsLXN0YWdlJykuaHRtbCgnJyk7XG5cdFx0alF1ZXJ5KHJlc3BvbnNlKS5lYWNoKGZ1bmN0aW9uKCBpZCwgcG9zdCApe1xuXHRcdFx0XG5cdFx0XHR2YXIgbWF0ZXJpYWxfbm9kZSA9ICc8ZGl2IGNsYXNzPVwibWF0ZXJpYWwtbm9kZVwiPjxoMj4nK3Bvc3QucG9zdF90aXRsZSsnPC9oMj4nO1xuXHRcdFx0bWF0ZXJpYWxfbm9kZSArPSAnPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwibWF0ZXJpYWxcIiB2YWx1ZT1cIicrcG9zdC5JRCsnXCIgLz4nO1xuXHRcdFx0bWF0ZXJpYWxfbm9kZSArPSAnPGRpdj4nO1xuXG5cdFx0XHRqUXVlcnkoJy53cC1ib29rLXBkZi1tYXRlcmlhbC1zdGFnZScpLmFwcGVuZCggbWF0ZXJpYWxfbm9kZSApO1xuXHRcdH0pO1xuXHRcdGpRdWVyeSgnLndwLWJvb2stcGRmLW1hdGVyaWFsLXN0YWdlJykuc29ydGFibGUoKTtcblx0fSk7XG59XG5cbmZ1bmN0aW9uIHNob3dfbm90aWNlKCBtZXNzYWdlLCB0eXBlLCBkaXNtaXNzaWJsZSApe1xuXHRpZiAoIGRpc21pc3NpYmxlICl7XG5cdFx0dmFyIGRpc21pc3NpYmxlX2NsYXNzID0gXCJpcy1kaXNtaXNzaWJsZVwiO1xuXHR9XG5cdHZhciBvdXRwdXQgPSAnPGRpdiBjbGFzcz1cIm5vdGljZSAnK3R5cGUrJyAnK2Rpc21pc3NpYmxlX2NsYXNzKydcIj4nO1xuXHRvdXRwdXQgKz0gJzxwPicrbWVzc2FnZSsnPC9wPic7XG4gICAgb3V0cHV0ICs9ICc8L2Rpdj4nO1xuXHRqUXVlcnkoJy53cC1ib29rLWZvcm0td3JhcHBlcicpLnByZXBlbmQoIG91dHB1dCApXG59Il19
